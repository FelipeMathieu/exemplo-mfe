function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,o)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(o){E(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function b(e){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){return(y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function v(e,t){var n;if(typeof(n=t.domElement?function(){return t.domElement}:t.domElementGetter?t.domElementGetter:e.domElementGetter?e.domElementGetter:function(o){var a=o.appName||o.name;if(!a)throw Error("single-spa's dom-element-getter-helpers was not given an application name as a prop, so it can't make a unique dom element container for the react application");var r="single-spa-application:".concat(a);return function(){var c=document.getElementById(r);return c||((c=document.createElement("div")).id=r,document.body.appendChild(c)),c}}(t))!="function")throw Error("single-spa's dom-element-getter-helpers was given an invalid domElementGetter for application or parcel '".concat(t.name,"'. Expected a function, received ").concat(y(n)));return function(){var o=n(t);if(!(o instanceof HTMLElement))throw Error("single-spa's dom-element-getter-helpers: domElementGetter returned an invalid dom element for application or parcel '".concat(t.name,"'. Expected HTMLElement, received ").concat(y(o)));return o}}var p=null;try{p=require("react").createContext()}catch{}var O={React:null,ReactDOM:null,ReactDOMClient:null,rootComponent:null,loadRootComponent:null,errorBoundary:null,errorBoundaryClass:null,domElementGetter:null,parcelCanUpdate:!0,suppressComponentDidCatchWarning:!1,domElements:{},renderResults:{},updateResolves:{},unmountResolves:{}};function j(e){if(b(e)!=="object")throw new Error("single-spa-react requires a configuration object");var t,n=m(m({},O),e);if(!n.React)throw new Error("single-spa-react must be passed opts.React");if(!n.ReactDOM&&!n.ReactDOMClient)throw new Error("single-spa-react must be passed opts.ReactDOM or opts.ReactDOMClient");if(n.renderType||((t=n.ReactDOMClient)!==null&&t!==void 0&&t.createRoot?n.renderType="createRoot":n.renderType="render"),!n.rootComponent&&!n.loadRootComponent)throw new Error("single-spa-react must be passed opts.rootComponent or opts.loadRootComponent");if(n.errorBoundary&&typeof n.errorBoundary!="function")throw Error("The errorBoundary opt for single-spa-react must either be omitted or be a function that returns React elements");!p&&n.React.createContext&&(p=n.React.createContext()),n.SingleSpaRoot=function(a){function r(c){r.displayName="SingleSpaRoot(".concat(c.name,")")}return r.prototype=Object.create(a.React.Component.prototype),r.prototype.componentDidMount=function(){setTimeout(this.props.mountFinished)},r.prototype.componentWillUnmount=function(){setTimeout(this.props.unmountFinished)},r.prototype.render=function(){return setTimeout(this.props.updateFinished),this.props.children},r}(n);var o={bootstrap:w.bind(null,n),mount:S.bind(null,n),unmount:B.bind(null,n)};return n.parcelCanUpdate&&(o.update=D.bind(null,n)),o}function w(e,t){return e.rootComponent?Promise.resolve():e.loadRootComponent(t).then(function(n){e.rootComponent=n})}function S(e,t){return new Promise(function(n,o){e.suppressComponentDidCatchWarning||!function(u){if(!(u&&typeof u.version=="string"&&u.version.indexOf(".")>=0))return!1;var i=u.version.slice(0,u.version.indexOf("."));try{return Number(i)>=16}catch{return!1}}(e.React)||e.errorBoundary||e.errorBoundaryClass||(e.rootComponent.prototype?e.rootComponent.prototype.componentDidCatch||console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.")):console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent does not implement an error boundary.  If using a functional component, consider providing an opts.errorBoundary to singleSpaReact(opts).")));var a=C(e,t,function(){n(this)}),r=v(e,t)(),c=function(u){var i=u.reactDom,s=u.renderType,d=u.elementToRender,f=u.domElement,l=i[s];if(typeof l!="function")throw new Error('renderType "'.concat(s,'" did not return a function.'));switch(s){case"createRoot":case"unstable_createRoot":case"createBlockingRoot":case"unstable_createBlockingRoot":var R=l(f);return R.render(d),R;case"hydrateRoot":return l(f,d);case"hydrate":default:return l(d,f),null}}({elementToRender:a,domElement:r,reactDom:h(e),renderType:T(e)});e.domElements[t.name]=r,e.renderResults[t.name]=c})}function B(e,t){return new Promise(function(n){e.unmountResolves[t.name]=n;var o=e.renderResults[t.name];o&&o.unmount?o.unmount():h(e).unmountComponentAtNode(e.domElements[t.name]),delete e.domElements[t.name],delete e.renderResults[t.name]})}function D(e,t){return new Promise(function(n){e.updateResolves[t.name]||(e.updateResolves[t.name]=[]),e.updateResolves[t.name].push(n);var o=C(e,t,null),a=e.renderResults[t.name];if(a&&a.render)a.render(o);else{var r=v(e,t)();h(e).render(o,r)}})}function h(e){return e.ReactDOMClient||e.ReactDOM}function T(e){return typeof e.renderType=="function"?e.renderType():e.renderType}function C(e,t,n){var o=e.React.createElement(e.rootComponent,t),a=p?e.React.createElement(p.Provider,{value:t},o):o;return(e.errorBoundary||t.errorBoundary||e.errorBoundaryClass||t.errorBoundaryClass)&&(e.errorBoundaryClass=e.errorBoundaryClass||t.errorBoundaryClass||function(r,c){function u(i){r.React.Component.apply(this,arguments),this.state={caughtError:null,caughtErrorInfo:null},u.displayName="SingleSpaReactErrorBoundary(".concat(i.name,")")}return u.prototype=Object.create(r.React.Component.prototype),u.prototype.render=function(){return this.state.caughtError?(r.errorBoundary||c.errorBoundary)(this.state.caughtError,this.state.caughtErrorInfo,this.props):this.props.children},u.prototype.componentDidCatch=function(i,s){this.setState({caughtError:i,caughtErrorInfo:s})},u}(e,t),a=e.React.createElement(e.errorBoundaryClass,t,a)),a=e.React.createElement(e.SingleSpaRoot,m(m({},t),{},{mountFinished:n,updateFinished:function(){e.updateResolves[t.name]&&(e.updateResolves[t.name].forEach(function(r){return r()}),delete e.updateResolves[t.name])},unmountFinished:function(){e.unmountResolves[t.name]&&(e.unmountResolves[t.name](),delete e.unmountResolves[t.name])}}),a)}export{p as SingleSpaContext,j as default};
